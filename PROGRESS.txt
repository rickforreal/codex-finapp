## 2026-02-16 03:41 — FEATURE-SYNTHWAVE84-BUILD | COMPLETE

Implemented Synthwave '84 as a new built-in server-defined theme: added `ThemeId.Synthwave84`, added a full Synthwave token bundle in `packages/server/src/themes/registry.ts`, and extended `/api/v1/themes` route tests to include Synthwave in built-in IDs.

Validation passed: `npm test`, `npm run typecheck`, `npm run lint`, and `npm run build`.
[QUESTION] Manual visual/persistence acceptance in `docs/features/themes/synthwave84/ACCEPTANCE.md` is still pending user verification.
## 2026-02-16 03:39 — FEATURE-SYNTHWAVE84-PLAN | COMPLETE

Created a decision-complete planning pack for Synthwave '84 under `docs/features/themes/synthwave84/` with implementation plan, task breakdown, acceptance criteria, and token-direction guidance.

[DECISION] Canonical docs were not updated at planning time because this feature is additive within existing server-defined themes architecture.
## 2026-02-16 02:34 — PHASE13-BUGFIXES | COMPLETE

Fixed two post-Phase-13 UX defects in client UI state/layout:
1) `CollapsibleSection` no longer clips long Additional Income / Large Expenses lists (replaced fixed max-height with measured animated height via `scrollHeight` + `ResizeObserver`).
2) Snapshot Load file picker no longer restricts file names via `accept` filter; loader now relies strictly on JSON/schema validation.

Validation passed: `npm run test -w @finapp/client`, `npm run typecheck -w @finapp/client`, and `npm run lint -w @finapp/client`.
## 2026-02-16 01:56 — FEATURE-MONOKAI-FOLLOWUP | COMPLETE

Fixed theme dropdown getting stuck on "Loading..." after snapshot load. Root cause: theme hydration fetch ran only on initial mount, so snapshot-restored empty/loading theme state had no refetch path.

Updated `packages/client/src/App.tsx` to rehydrate themes whenever catalog/definitions are missing, with an in-flight guard to prevent duplicate fetches. Client `test`, `typecheck`, and `lint` all pass.
## 2026-02-16 01:38 — FEATURE-MONOKAI-BUILD | COMPLETE

Implemented Monokai as a new built-in server-defined theme: added `ThemeId.Monokai`, added a full Monokai token bundle in `packages/server/src/themes/registry.ts`, and updated `/api/v1/themes` route tests to assert Monokai is included in built-in IDs.

Validation passed: `npm test`, `npm run typecheck`, `npm run lint`, and `npm run build`.
[QUESTION] Manual visual acceptance (`docs/features/themes/monokai/ACCEPTANCE.md`) is still pending user review, including live picker rendering and persistence smoke checks.
## 2026-02-16 01:34 — FEATURE-MONOKAI-PLAN | COMPLETE

Created a decision-complete feature planning pack under `docs/features/themes/monokai/` with implementation plan, task breakdown, acceptance checklist, and token-direction guidance.

[DECISION] No canonical doc updates were made in planning because Monokai is additive within the existing Phase 13 server-defined theming architecture.
## 2026-02-15 20:30 — SESSION START | Resuming from P12Z-T1. Last completed: Phase 12 closeout + doc reconciliation. Next: new Phase 13 theming foundation.

## 2026-02-15 20:30 — P13-T6 | COMPLETE

Implemented Phase 13 server-defined theming end-to-end: shared theme contracts/schemas, server theme registry + `/api/v1/themes`, client theme state + precedence resolution (`Snapshot > local preference > server default`), CSS-token theme engine, command-bar theme selector, and tokenized chart/stress/detail-table state colors.

[DECISION] Theme definitions are server-authored and client-selected by `ThemeId` only; no client-authored custom themes in Phase 13.
[DECISION] Built-in themes shipped: Light, Dark, High Contrast.
[ASSUMPTION] Color accessibility checks emit warnings (`ThemeValidationIssue`) rather than hard-failing startup to preserve intended visual identity while exposing contrast risk.

Validation passed: `npm run typecheck`, `npm run lint`, `npm test`, and `npm run build`.
## 2026-02-15 19:47 — P12Z-T1 | COMPLETE

Completed Phase 12 pragmatic closeout verification and documentation update.
[DECISION] CSV export (#56) is intentionally out of scope for this release and documented as an accepted scope delta in `docs/ENGINEERING.md`.
[DEFERRED] P12D-T4 (manual-mode Detail Ledger header whitespace) remains explicitly deferred and tracked in `TASKS.md`.

Full regression gate passed: `npm test`, `npm run typecheck`, `npm run lint`, and `npm run build`.

## 2026-02-15 19:40 — P12F-T1 | COMPLETE

Implemented Phase 12F loading-state UX for running simulations:
- Summary stats now shows a running-state loading indicator.
- Portfolio chart and Detail Ledger table now show centered loading overlays while simulation status is `running`.
- Existing cached content remains visible behind overlays for continuity during recomputation.

Validation passed: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 19:33 — P12E-T1 | COMPLETE

Phase 12E Stress Test update: changed default panel state to expanded (`stress.isExpanded = true`) so Stress Test content is visible by default.
Collapse/expand toggle behavior is unchanged.

Validation passed: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 19:27 — P12D-T4 | DEFERRED

User-approved deferral of remaining manual-mode `Detail Ledger` header whitespace issue after multiple sticky-offset fixes (including dynamic measured offset and scroll-state sync) did not fully resolve observed behavior.
[DEFERRED] Continue with next Phase 12 work and revisit this table-header spacing bug in a later focused pass.

## 2026-02-15 18:54 — P12D-T3 | COMPLETE

Implemented Phase 12D detail-table polish:
- Header controls updated: `Detail Ledger` title, right-aligned Monthly/Annual toggle, `Breakdown` label-style control, and icon-only expand/compress table mode button.
- Added keyboard-oriented cell interaction: click-to-select highlight, Tab/Shift+Tab traversal across cells, and Enter-to-edit for editable tracking cells with auto-selected value text.
- Monthly period labels now render as calendar dates (`YYYY-Mon`) anchored to `coreParams.retirementStartDate`; annual period labels now show calendar year.
- Added explicit Monte Carlo note that table values represent the median path.

Validation passed: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 18:47 — P12C-T3 | COMPLETE

Applied final chart/input QA polish requested after Phase 12B/12C review:
- Core Parameters copy/format updates (`Withdrawals Start`, inline `yrs`, revised labels).
- Historical Data header rename (`Returns`, `Volatility`) and spacing/alignment fixes.
- Breakdown control converted from switch to label-style toggle, then tuned to smaller non-bold text with brighter active blue.

Validation passed during iteration: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 18:37 — P12C-T3 | COMPLETE

Implemented Phase 12C chart-panel polish:
- Replaced `By Asset Class` wording with `Breakdown` and moved it to the right of the Nominal/Real toggle.
- Switched default chart display mode to Real.
- Removed the zoom slider container so chart shows full-horizon by default.
- Added Monte Carlo y-axis focus scaling using median/IQR-oriented ceiling so P50 trajectory is more legible while upper percentile bands may clip above the chart.

Validation passed: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 17:02 — P12B-T3 | COMPLETE

Implemented Phase 12B input-panel polish:
- Core Parameters now uses two rows (`Starting Age`, `Withdrawals Start At`, `Expected Inflation Rate`) and (`Retirement Start Date`, `Retirement Duration`).
- Withdrawal Strategy guidance now shows concise summary by default with an expand/collapse details panel covering parameter effects and strategy tradeoff commentary.
- Historical Data summary table was compressed to four fixed columns without horizontal scroll and now includes era-specific commentary text below the table.

Validation passed: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 16:57 — P12A-T2 | COMPLETE

Addressed navbar QA feedback: removed the visible gap in the Manual/Monte Carlo segmented toggle and added explicit hover tooltips to Save/Load snapshot icon buttons.
Updated `SegmentedToggle` layout to equal-width grid pills and added tooltip UI wrappers in `CommandBar`.

Validation passed: `npm run typecheck -w @finapp/client` and `npm run lint -w @finapp/client`.

## 2026-02-15 16:44 — SESSION START | Resuming from Phase 12, Task P12A-T1. Last completed: P11-T6 (packed snapshot output format).

Read startup context from `AGENTS.md`, `PROGRESS.txt`, and `TASKS.md`, then reviewed Phase 12 requirements in `docs/ENGINEERING.md` before implementation planning.

## 2026-02-15 16:44 — P12A-T2 | COMPLETE

Implemented Phase 12A navbar UX refresh in `packages/client/src/components/layout/CommandBar.tsx`: added fixed left FinApp brand block, compact command-group labels, right-aligned Run Simulation action cluster, and icon-only Save/Load snapshot controls with tooltip titles and accessibility labels.
Tracking controls were kept near mode controls, Monte Carlo historical era remains conditional, and existing command behaviors were preserved.

Verification passed: `npm run typecheck`, `npm run lint`, `npm test`, and `npm run build`.

## 2026-02-14 04:49 — P5-T6 | COMPLETE

Manual Phase 5 verification accepted by user review; Phase 5 marked complete.
Confirmed monthly/annual toggle, asset column toggle with contained horizontal scroll, sticky headers, sortable columns, virtualization behavior, and rerun update flow.

## 2026-02-14 04:37 — P5-T6 | IN PROGRESS

Phase 5 automated verification passed with no regressions: `npm run build`, `npm run typecheck`, `npm run lint`, and `npm test` all succeed (server tests 25/25).
Manual visual DoD pass for table interactions remains pending user confirmation.

## 2026-02-14 04:35 — P5-T5 | COMPLETE

Integrated `DetailTable` into the output stack below chart and summary components; table updates from cached simulation results only.
Input edits without rerun preserve existing table data, while reruns refresh rows for the current mode dataset.

## 2026-02-14 04:34 — P5-T4 | COMPLETE

Implemented monthly-view row virtualization with overscan and spacer rows for scalable rendering up to full 480-month horizons.
Sticky control/header behavior is preserved while scrolling within the table container.

## 2026-02-14 04:32 — P5-T3 | COMPLETE

Added sortable headers across table columns with asc/desc/off cycle and consistent number formatting for currency and percentage cells.
Sorting is applied to both monthly and annual datasets via shared table helpers.

## 2026-02-14 04:31 — P5-T2 | COMPLETE

Implemented Detail Table UI with Monthly/Annual toggle (#49), Asset Class Columns toggle (#50), sticky controls/header (#51), and empty state before first run.
Added output table layout and control wiring in the output panel.

## 2026-02-14 04:30 — P5-T1 | COMPLETE

Extended store with table view actions (`setTableGranularity`, `setTableAssetColumnsEnabled`, `setTableSort`) and added row transformation/sorting helpers for monthly + annual data.
Implemented annual aggregation and table-ready row projection from simulation output rows.

## 2026-02-14 04:28 — SESSION START | Resuming from Phase 5, Task P5-T1. Last completed: P4-T6 (Phase 4 complete).

Read startup state and Phase 5 requirements from `docs/ENGINEERING.md` and `docs/SPECS.md` before implementation.

## 2026-02-14 04:14 — P4-T6 | COMPLETE

Manual Phase 4 visual verification accepted by user review; Phase 4 marked complete.
Output chart/stats affordances (#33-#40, #42-#44, #47-#48) validated with rerun behavior and stochastic manual-run flow.

## 2026-02-14 04:01 — P4-T6 | IN PROGRESS

Phase 4 automated verification passes: `npm run build`, `npm run typecheck`, `npm run lint`, and `npm test` all succeed with server Phase 2 suite still green (22/22).
Manual visual DoD pass for chart/stats interactions remains pending user confirmation.

## 2026-02-14 04:00 — P4-T5 | COMPLETE

Integrated `SummaryStatsBar` and `PortfolioChart` into `AppShell` output area with idle-state rendering and cached-result display behavior.
Input edits now leave prior run outputs unchanged until Run Simulation executes again, preserving Phase 4 rerun semantics.

## 2026-02-14 03:59 — P4-T4 | COMPLETE

Added chart hover crosshair/tooltip (period, portfolio value, withdrawal), zoom range sliders, and Reset Zoom control in `PortfolioChart`.
Zoom state is persisted in store (`ui.chartZoom`) and applies only to rendered run results.

## 2026-02-14 03:57 — P4-T3 | COMPLETE

Implemented output chart rendering for manual single-path runs with total line view and asset-class stacked area toggle.
Added Real/Nominal display mode switching that recalculates y-axis scale and plotted series from inflation-adjusted values.

## 2026-02-14 03:55 — P4-T2 | COMPLETE

Implemented `SummaryStatsBar` + `StatCard` components for affordances #33–#40 with idle placeholders, computed values, and terminal-value success/failure styling.
Probability of Success card (#41) remains intentionally hidden until Monte Carlo support in Phase 8.

## 2026-02-14 03:53 — P4-T1 | COMPLETE

Added Phase 4 output helpers: active result selector, formatting utilities, and summary statistics computations (nominal + real withdrawal metrics).
Statistics derive directly from cached `MonthlySimulationRow[]` to keep output updates tied to simulation runs only.

## 2026-02-14 03:50 — SESSION START | Resuming from Phase 4, Task P4-T1. Last completed: P3-T6 (Phase 3 complete and pushed).

Read startup context (`PROGRESS.txt`, `TASKS.md`) and pulled Phase 4 requirements from `docs/ENGINEERING.md`, `docs/SPECS.md`, `docs/ARCHITECTURE.md`, `docs/DATA_MODEL.md`, `docs/API.md`, `docs/PRD.md`, and `docs/SCENARIOS.md` before implementation.

## 2026-02-14 03:42 — P3-T6 | COMPLETE

Manual Phase 3 verification accepted by user review; Phase 3 marked complete.
Confirmed sidebar input round-trip behavior, collapsible interactions, and run-simulation cache write path are ready for Phase 4 handoff.

## 2026-02-14 03:34 — P3-T5 | COMPLETE

Phase 3 regression and static checks passed: `npm run build`, `npm run typecheck`, `npm run lint`, and `npm test` all succeed after client input-panel wiring.
Phase 2 engine/route tests remain green (22/22 passing).

## 2026-02-14 03:32 — P3-T4 | COMPLETE

Wired command bar mode toggles to Zustand store and integrated Run Simulation API call to `/api/v1/simulate`, caching results in store without rendering output views.
Implemented strategy selector with all 12 names; only Constant Dollar parameters are active and others show "coming in Phase 6".
[ASSUMPTION] To keep requests valid before Phase 6/7 implementation, run payload generation coerces unsupported strategy/drawdown selections to Constant Dollar + Bucket.

## 2026-02-14 03:30 — P3-T3 | COMPLETE

Implemented sidebar input sections for Core Parameters, Starting Portfolio, Return Assumptions, Spending Phases, Withdrawal Strategy, Drawdown Strategy, Income Events, and Expense Events.
All controls are wired as controlled inputs to Zustand state and re-render from store values; Return Assumptions visibility toggles by simulation mode.

## 2026-02-14 03:28 — P3-T2 | COMPLETE

Added shared input/display primitives required by Phase 3: NumericInput, CurrencyInput, PercentInput, SegmentedToggle, Dropdown, MonthYearPicker, ToggleSwitch, DonutChart, and CollapsibleSection.
Sidebar sections now use these shared controls consistently.

## 2026-02-14 03:26 — P3-T1 | COMPLETE

Expanded client store model/actions for full input wiring, including spending phase cascade logic, bucket ordering controls, income/expense event CRUD, section collapse state, and simulation cache status.
Added guardrails for phase add/remove constraints (max 4 phases; prevent deleting last phase).
## 2026-02-14 03:09 — P2-T6 | COMPLETE

Phase 2 DoD verification passed: `npm run build`, `npm run typecheck`, `npm run lint`, and `npm test` all succeed.
Validated live API call on `POST /api/v1/simulate` (server on port 3011) returning 120 monthly rows; Year 1 monthly withdrawal = `333333`, Year 2 monthly withdrawal = `343333`, and first stocks draw occurs only after cash depletion.

## 2026-02-14 03:05 — P2-T5 | COMPLETE

Added required Phase 2 test suite: strategy, drawdown, simulator, helpers, and route integration tests under `packages/server/tests`.
All required test files now pass with deterministic assertions for Year 1/Year 2 withdrawal behavior and bucket depletion order.

## 2026-02-14 03:03 — P2-T4 | COMPLETE

Implemented `simulateRetirement` month loop and `POST /api/v1/simulate` route with shared Zod validation.
Invalid request payloads now return 400 with structured field-level errors; valid payloads return `SimulateResponse` monthly rows and summary.

## 2026-02-14 03:01 — P2-T3 | COMPLETE

Implemented Constant Dollar strategy and Bucket drawdown modules in server engine.
Constant Dollar follows Year 1 portfolio-rate rule and Year 2+ inflation-adjusted prior-clamped withdrawal rule; Bucket drawdown applies sequential asset depletion with shortfall reporting.

## 2026-02-14 03:00 — P2-T2 | COMPLETE

Implemented helper modules for `roundToCents`, `pmt`, inflation utilities, and return generation scaffolding.
PMT includes zero-rate fallback and positive-rate formula aligned with the strategy appendix.

## 2026-02-14 02:58 — P2-T1 | COMPLETE

Expanded shared domain/contracts with full Phase 2 simulation configuration/result types and `SimulateRequest`/`SimulateResponse` contracts.
Added `simulateRequestSchema` (Zod) with field constraints for API validation.
## 2026-02-14 02:53 — P1-T6 | COMPLETE

Ran Phase 1 verification commands successfully: `npm run build`, `npm run typecheck`, `npm run lint`, and `npm test`.
Validated `npm run dev` startup outside sandbox (client + server started), and verified health endpoint response with `curl http://localhost:3001/api/v1/health` -> `{"status":"ok"}`.
[DECISION] Browser rendering + console log behavior is implemented and ready for user manual verification during review.

## 2026-02-14 02:50 — P1-T5 | COMPLETE

Created Zustand store scaffold matching the architecture tree in `packages/client/src/store/useAppStore.ts` with slice stubs in `packages/client/src/store/slices/*`.
Store includes mode, simulation mode, core params, portfolio, strategy slices, events, simulation results, and UI state placeholders.

## 2026-02-14 02:47 — P1-T4 | COMPLETE

Scaffolded Vite + React + Tailwind client with a command bar placeholder, sidebar/output `AppShell`, and themed color tokens aligned to SPECS palette (`#1A365D`, `#4A90D9`, `#2EAD8E`, amber cash color).
Added typed API health client and app-mount health call logging in `packages/client/src/App.tsx`.

## 2026-02-14 02:43 — P1-T3 | COMPLETE

Implemented Fastify app with CORS and structured logger config, plus `GET /api/v1/health` route returning `{ status: "ok" }`.
Added server entrypoint with configurable `PORT` and startup logging.

## 2026-02-14 02:41 — P1-T2 | COMPLETE

Created shared package structure under `packages/shared/src/{domain,contracts,ui,constants}` with placeholder `SimulationConfig` and `SimulationResult` stubs and required enums (`AssetClass`, `WithdrawalStrategyType`, `SimulationMode`).
Configured ESLint import-boundary rule preventing `domain`/`contracts` imports from `ui`; verified by temporary probe import that fails lint.

## 2026-02-14 02:39 — P1-T1 | COMPLETE

Initialized the monorepo baseline for Phase 1 with root workspace/tooling files and package scaffolding for `client`, `server`, and `shared`. Added root scripts for `dev`, `build`, `test`, `typecheck`, and `lint`.

## 2026-02-14 02:39 — SESSION START | Resuming from P1-T1. Last completed: none. Next: P1-T1 (Initialize monorepo workspace scaffolding).

Read startup context files and required architecture/spec docs for Phase 1 before editing. `PROGRESS.txt` was empty and `TASKS.md` did not exist, so Phase 1 planning started from a clean state.

## 2026-02-14 10:30 — P6-T1..P6-T5 | COMPLETE

Implemented Phase 6 end-to-end across shared/server/client.

- Expanded shared withdrawal strategy domain model to a full discriminated union with 12 strategy-specific param shapes.
- Expanded `simulateRequestSchema` to validate all strategy variants via a discriminated union.
- Added server strategy registry (`engine/strategies/index.ts`) and 11 new strategy modules: Percent of Portfolio, 1/N, VPW, Dynamic SWR, Sensible Withdrawals, 95% Rule, Guyton-Klinger, Vanguard Dynamic Spending, Endowment, Hebeler Autopilot II, CAPE-Based.
- Updated simulator annual strategy calculation to use registry context (year, retirement horizon, previous clamped withdrawal, prior-year return, remaining years, and prior-year start portfolio).
- Added strategy test coverage: one test file per strategy (12 total including existing Constant Dollar) with Year 1, multi-year, and edge checks. Guyton-Klinger includes rule-specific and worked-example sequence coverage.
- Implemented client Phase 6 strategy parameter panels and per-strategy tooltip content; removed prior Constant-Dollar coercion in `getCurrentConfig` so selected strategy is sent to server.
- Added `setWithdrawalParam` store action and full strategy default parameter state.
- Updated `TASKS.md` with Phase 6 granular tasks and marked complete.

Verification run (all passing):
- `npm run build`
- `npm run typecheck`
- `npm run lint`
- `npm test`

## 2026-02-14 13:15 — Post-Phase 6 polish | COMPLETE

Applied post-review UI refinements and defaults tuning before Phase 7:

- Added Detail Table `Spreadsheet Mode` toggle in output controls.
  - When enabled, table container internal scrollbars are removed.
  - Monthly virtualization is disabled so all rows render continuously (spreadsheet-style expansion).
  - Horizontal/vertical scrolling is delegated to the page/layout instead of the inner table viewport.
- Corrected default client portfolio values to dollar-scale inputs:
  - Stocks: $2,000,000
  - Bonds: $250,000
  - Cash: $50,000
- Adjusted default spending phase bounds to:
  - Min monthly: $6,000
  - Max monthly: $12,000

Verification:
- `npm run typecheck -w @finapp/client` passes.
- `npm run lint -w @finapp/client` passes.

## 2026-02-14 13:26 — Defect fix: withdrawalsStartAt ignored | COMPLETE

Fixed a withdrawal-start timing bug where engine withdrawals were being computed/clamped from Year 1 regardless of `coreParams.withdrawalsStartAt`.

Changes:
- Server simulator now computes `withdrawalStartYear = max(1, withdrawalsStartAt - startingAge)` and suppresses both strategy calculation and spending-phase clamping before that year.
- Added simulator regression test for delayed start case (`startingAge=55`, `withdrawalsStartAt=60`) validating Year 1-4 withdrawals are zero and Year 5 starts withdrawals.
- Client spending phase boundary recalculation now respects the same start-year delta so Phase 1 no longer always hard-pins to Year 1 after core param edits.

Verification:
- `npm run test -w @finapp/server` passes (including new regression test).
- `npm run typecheck -w @finapp/client` passes.
- `npm run lint -w @finapp/client` passes.

## 2026-02-14 13:31 — Defect fix: spending phase boundary pinning | COMPLETE

Fixed Spending Phase boundary behavior for timeline constraints:

- First phase `startYear` is now pinned to the withdrawals-start delta year (`withdrawalsStartAt - startingAge`, clamped to timeline).
- Last phase `endYear` is now pinned to `retirementDuration` so it always updates when retirement duration changes.
- UI now locks boundary inputs accordingly:
  - first phase `Start Year` is non-editable
  - last phase `End Year` is non-editable
  - with a single phase, both boundary fields are non-editable
- Store-side patch sanitization now ignores user attempts to mutate locked boundaries directly.

Verification:
- `npm run typecheck -w @finapp/client` passes.
- `npm run lint -w @finapp/client` passes.

## 2026-02-14 13:47 — Defect fix: phase add boundary inversion + age clamp | COMPLETE

Fixed two related client-side validation/state issues:

- Resolved Spending Phase add-path bug that could create `Start Year > End Year` (e.g., Phase 2 start 36 / end 35 after changing retirement duration and adding a phase).
  - Root cause: boundary recalculation used prior *raw* phase values instead of prior recalculated boundaries.
  - Fix: switched to sequential recalculation using accumulated prior end-year, with timeline-cap aware bounds per remaining phases.
- Enforced `Withdrawals Start At >= Starting Age`:
  - UI input minimum now tracks current `startingAge`.
  - Store mutation clamps `withdrawalsStartAt` upward if user sets it lower.
  - Updating `startingAge` now also raises `withdrawalsStartAt` if needed.
- Added add-phase capacity guard based on available timeline years so impossible boundary packing is prevented.

Verification:
- `npm run typecheck -w @finapp/client` passes.
- `npm run lint -w @finapp/client` passes.

## 2026-02-14 15:28 — Phase 7: Drawdown & Events | COMPLETE

Implemented full Phase 7 across shared contracts, server engine, client input UI, and verification.

Changes:
- Shared model/contracts (`@finapp/shared`):
  - Upgraded drawdown config to support both `bucket` and `rebalancing` strategies via discriminated union.
  - Added full event domain fields for income/expense timing and behavior:
    - `depositTo` / `sourceFrom`
    - `start`, `end` (including `"endOfRetirement"`)
    - `frequency`
    - `inflationAdjusted`
  - Expanded `simulateRequestSchema` validation:
    - Rebalancing target allocation must sum to 1 (100%).
    - Glide path allocation entries must sum to 1.
    - Glide path requires >= 2 waypoints when enabled.
    - Recurring events require `end >= start`.
- Server drawdown engine:
  - Added `engine/drawdown/rebalancing.ts` with:
    - Overweight-first withdrawal sourcing.
    - Proportional fallback drawdown across remaining assets.
    - Glide path interpolation helper by retirement year.
    - Partial-fulfillment + shortfall reporting.
  - Added drawdown registry (`engine/drawdown/index.ts`) used by simulator.
- Server simulator:
  - Replaced bucket-only sourcing with strategy-aware drawdown dispatch.
  - Added monthly income processing (timing/frequency/inflation/deposit asset).
  - Added monthly expense processing (timing/frequency/inflation/source asset/follow-drawdown).
  - Expense shortfall now contributes to `summary.totalShortfall`.
  - Row-level `incomeTotal` and `expenseTotal` are now populated.
- Client store + request wiring:
  - `getCurrentConfig()` now emits full Phase 7 drawdown/event payloads (no rebalancing coercion).
  - Added rebalancing actions: target allocation update, glide-path enable, waypoint add/remove/update.
  - Added income/expense preset creation paths.
  - Added retirement-duration glide-path boundary clamping for first/last waypoint years.
- Client UI:
  - Replaced Phase-7 placeholder with `RebalancingConfig` panel:
    - Target allocation % inputs with total validation display.
    - Glide-path toggle + waypoint editor + lightweight preview.
  - Upgraded income/expense cards with:
    - start + end date controls
    - frequency controls
    - inflation toggle
    - add-preset quick buttons
  - `Run Simulation` is blocked in UI when Rebalancing target allocation total != 100%.
- Tests:
  - Added `packages/server/tests/engine/drawdown/rebalancing.test.ts`.
  - Added `packages/server/tests/engine/events.test.ts`.
  - Added simulator integration coverage for rebalancing + income + expenses in `simulator.test.ts`.

Tooling adjustment:
- Updated root scripts so `npm run typecheck` and `npm test` build shared first, preventing stale shared runtime/type artifacts during cross-package checks.

Verification run (all passing):
- `npm run build`
- `npm run typecheck`
- `npm run lint`
- `npm test`

2026-02-15 — Phase 8 (Monte Carlo) complete

Completed:
- Shared contracts/types:
  - Added `HistoricalEra` enum and `constants/eras.ts` definitions.
  - Added Monte Carlo domain types (`MonteCarloResult`, percentile curves, historical summaries) and extended `SimulateResponse` with mode/seed/mc payload.
  - Updated request validation so `selectedHistoricalEra` must be a known era key.
- Server engine/routes:
  - Added `engine/historicalData.ts` for CSV loading, era filtering, and per-asset summary stats.
  - Added `engine/monteCarlo.ts` for N-run historical sampling with replacement, seeded determinism, per-asset percentile aggregation, terminal values, PoS, and representative median-like path.
  - Extended `POST /api/v1/simulate` to execute manual or Monte Carlo based on `config.simulationMode`.
  - Added `GET /api/v1/historical/summary` and registered route in `app.ts`.
- Client UI/state:
  - Added Monte Carlo era selector in `CommandBar` (#11a) and wired summary fetch on era changes.
  - Replaced Return Assumptions content with `HistoricalDataSummary` in Monte Carlo mode.
  - Added confidence bands + median line rendering in `PortfolioChart` with MC percentile tooltip values.
  - Added Probability of Success stat card (#41) with color thresholds (green >=90%, amber 75-89%, red <75%).
- Tests:
  - Added `historicalData.test.ts` (CSV parsing + era bounds + summary sanity).
  - Added `monteCarlo.test.ts` (determinism, 100%/0% PoS extremes, per-asset percentile aggregation, 1000-run performance).
  - Added `routes/historical.test.ts` and extended `routes/simulation.test.ts` with Monte Carlo response/plausibility coverage.

Verification run (all passing):
- `npm run build`
- `npm run typecheck`
- `npm run lint`
- `npm test`

2026-02-15 — Phase 9 (Tracking Mode) implementation pass

Completed:
- Shared contracts/domain:
  - Added `ActualMonthOverride` + `ActualOverridesByMonth` in shared domain.
  - Extended `SimulateRequest` with optional `actualOverridesByMonth`.
  - Added `ReforecastRequest` / `ReforecastResponse` contracts.
  - Added `reforecastRequestSchema` and actual-override schema validation.
- Server:
  - Added deterministic engine: `packages/server/src/engine/deterministic.ts`.
  - Added `POST /api/v1/reforecast` route: `packages/server/src/routes/reforecast.ts`.
  - Registered reforecast route in server app bootstrap.
- Client state and APIs:
  - Added `runReforecast` API wrapper.
  - Added Tracking actual override state/actions:
    - `actualOverridesByMonth`, `lastEditedMonthIndex`
    - `upsertActualOverride`, `clearActualRowOverrides`, `clearAllActualOverrides`
  - Added mode-isolated workspace switching behavior via clone/snapshot swap on mode toggle:
    - first switch to Tracking clones Planning once and clears Tracking caches.
    - subsequent mode switches restore per-mode inputs/results.
  - Active result selector now prefers `reforecast` in Tracking + Manual mode.
- Detail table Tracking UX:
  - Monthly editable cells for start balances, by-asset withdrawals, income, expenses.
  - Edited value visuals: tint + bold + dot marker.
  - Row-region tint through latest edited month.
  - Row reset action in monthly view.
  - Stale pill in Tracking + Monte Carlo when MC is stale.
  - Tracking-first empty-state prompt now requires initial run to bootstrap editable rows.
- Chart Tracking UX:
  - Added boundary marker and label: `Actuals -> Simulated`.
  - Added stale dim + warning banner for Tracking + Monte Carlo stale state.
  - Added split rendering path for Tracking + Monte Carlo (realized left / simulated bands right).
- Command bar Tracking UX:
  - Added Actuals watermark text (`No actuals entered` / `Actuals through: MMM YYYY`).
  - Added `Clear Actuals` action in Tracking mode.
- Tests:
  - Added `packages/server/tests/engine/deterministic.test.ts`.
  - Added `packages/server/tests/routes/reforecast.test.ts`.

Verification run (all passing):
- `npm run build`
- `npm run typecheck`
- `npm run lint`
- `npm test`
- Follow-up UX fix: Tracking table now renders edited override values directly in cells (not just markers), including frozen MC stale state.
- Phase 9 post-review defect fixes:
  - Fixed Tracking + Manual first-run behavior: deterministic reforecast is now gated behind actual edits (`lastEditedMonthIndex !== null`), so initial Tracking manual runs remain stochastic.
  - Fixed active-result selection in Tracking + Manual: reforecast is only preferred when actual edits exist; otherwise manual simulation result is shown.
  - Fixed Tracking + Monte Carlo override propagation: `/api/v1/simulate` now passes `actualOverridesByMonth` into both manual and Monte Carlo engines.
  - Extended `simulateRetirement` to honor month-level overrides for start balances, by-asset withdrawals, income, and expenses.
  - Extended Monte Carlo runner to apply the same actual overrides on each path before percentile aggregation.
- Added regression tests:
  - `packages/server/tests/engine/simulator.test.ts`: verifies overrides affect start balances, withdrawals, and end balances.
  - `packages/server/tests/routes/simulation.test.ts`: verifies overrides are applied for both Manual and Monte Carlo `/simulate` responses.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Phase 9 tracking behavior fix (manual edit recalculation semantics):
  - Replaced Tracking+Manual edit recalculation path in `DetailTable` from `/reforecast` deterministic run to `/simulate` with explicit `monthlyReturns` derived from the current manual result rows.
  - Effect: editing in Tracking+Manual now preserves existing stochastic month returns and recomputes congruently from edited context, instead of visually turning the whole path deterministic.
  - Because row-level values are now recomputed through the main simulator, same-month derived fields stay congruent after start-balance edits (e.g., `Start Total`, `Market Move`, `Return %`, per-asset move columns).
- Files updated:
  - `packages/client/src/components/output/DetailTable.tsx`

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Phase 9 tracking follow-up fix (manual boundary preservation + row congruence display):
  - Updated `packages/client/src/components/output/DetailTable.tsx` recalculation merge behavior so Tracking+Manual keeps rows through `lastEditedMonthIndex` from the visible result and only takes recomputed rows after that boundary.
  - Added start-balance delta propagation in detail-table display for edited rows:
    - `Start Total`, `Market Move`, `Return %`
    - `Move Stocks`, `Move Bonds`, `Move Cash`
  - Updated edit-entry prefill to use displayed (override-aware) values.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Phase 9 tracking defect follow-up:
  - Fixed Tracking+Manual `Run Simulation` behavior to preserve rows through `lastEditedMonthIndex` (inclusive) and recompute only future rows in the displayed result.
  - Fixed same-row congruence for start-balance edits to include end columns:
    - `End Stocks`, `End Bonds`, `End Cash`, and `End Total` now derive from override-adjusted start/move/withdrawal values.
- Files updated:
  - `packages/client/src/components/layout/CommandBar.tsx`
  - `packages/client/src/components/output/DetailTable.tsx`

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Tracking+Manual run fix after table edit:
  - Updated `packages/client/src/components/layout/CommandBar.tsx` so `Run Simulation` in Tracking+Manual with edits no longer reuses the exact prior monthly returns path.
  - Run now performs a fresh stochastic simulation with overrides, then preserves rows through the edit boundary in the displayed result.
  - This restores visible run behavior after edits while keeping historical/edited rows fixed.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- Tracking+MonteCarlo preservation fix:
  - Updated `packages/client/src/components/layout/CommandBar.tsx` to apply edit-boundary row preservation for Tracking+MonteCarlo runs, matching Tracking+Manual behavior.
  - On Run in Tracking mode with `lastEditedMonthIndex` set (Manual or MonteCarlo), simulation result rows now preserve months through the edited boundary and only replace future months.
- UX polish updates:
  - Summary stats terminal card now consistently shows `Portfolio End (Real)` in both Manual and Monte Carlo modes.
  - Portfolio chart SVG now uses `preserveAspectRatio="none"` so the plotted area fills the container width on large screens.
  - Detail-table preserved-row tint increased from very light blue to a darker shade for clearer distinction.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Phase 10 implemented: Stress Testing vertical slice.
  - Added shared stress domain/contracts/schemas:
    - `StressScenario` discriminated union (stock/bond/broad crash, prolonged bear, inflation spike, custom)
    - `StressTestRequest` / `StressTestResponse`
    - `StressTestResult` + scenario comparison/timing shapes.
  - Server:
    - Added `engine/stress.ts` for scenario overlays, base comparison metrics, and manual timing sensitivity sweeps.
    - Extended `simulateRetirement` with optional inflation-by-year overrides for inflation stress scenarios.
    - Extended `runMonteCarlo` with optional return-transform and inflation-override hooks for stress overlays.
    - Added `POST /api/v1/stress-test` route and registered route plugin.
  - Client:
    - Added stress API wrapper `packages/client/src/api/stressApi.ts`.
    - Added workspace-isolated stress state/actions in `useAppStore`.
    - Added `StressTestPanel` with collapsible UI, scenario cards, add/remove (max 4), auto recompute, comparison bars/table, and manual-only timing chart.
    - Integrated panel in output flow below detail table.
  - Tests added:
    - `packages/server/tests/engine/stress.test.ts`
    - `packages/server/tests/routes/stress.test.ts`

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Phase 10 UX and correctness refinements:
  - Main portfolio chart now overlays stress scenario paths with per-scenario legend.
  - Fixed Manual stress comparison path consistency:
    - Added `monthlyReturns` to stress request contract/schema.
    - Client now sends inferred base monthly returns for manual stress runs.
    - Server stress engine now uses provided monthly returns so base vs scenario shares identical underlying path.
  - Main chart tooltip now includes stress scenario point-in-time values (portfolio + withdrawal).
  - Tooltip clipping fix:
    - Chart keeps SVG clipped while tooltip renders in overflow-visible layer above container.
  - Stress panel display refresh:
    - Replaced large horizontal bars with compact vertical charts.
    - Added Median and Mean Monthly Withdrawal comparison charts.
    - Removed Timing Sensitivity chart from Stress panel UI.
    - Compacted metrics table spacing and typography.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Documentation alignment pass completed to reflect implemented behavior as source of truth:
  - Updated `docs/PRD.md` for stateless backend wording, independent Planning/Tracking workspaces, and stress overlay framing.
  - Updated `docs/SPECS.md` for workspace isolation, Tracking initialization/edit boundary semantics, stale indicators, `Portfolio End (Real)` stat label, annualized historical summary labels, spreadsheet mode, expanded editable columns, and stress panel chart changes (compact vertical charts, no timing-sensitivity panel).
  - Updated `docs/SCENARIOS.md` narratives for annualized historical summary, Tracking initialization run, MC stale UX, stress chart overlays, and portfolio-end terminology.
  - Replaced `docs/API.md` with current implemented `/api/v1` contract surface (`/health`, `/simulate`, `/historical/summary`, `/reforecast`, `/stress-test`).
  - Updated `docs/ARCHITECTURE.md` and `docs/ENGINEERING.md` with implementation deltas for workspace-isolated state and final stress UI direction.
- [ASSUMPTION] Phase 11 scope intentionally de-scoped explicit app-level Undo/Redo (#62/#63) in favor of snapshot-only recovery; browser-native field undo remains incidental and non-contractual.
- Phase 11 implementation completed (snapshot persistence):
  - Added client snapshot module `packages/client/src/store/snapshot.ts` with JSON envelope serialization, strict schema version matching, Zod validation, sanitized filenames, and full-state restore.
  - Added Save/Load Snapshot controls to `packages/client/src/components/layout/CommandBar.tsx` (prompt for name, file picker load, replacement confirmation, and user-visible success/error messaging).
  - Extended store typing/actions in `packages/client/src/store/useAppStore.ts` to expose `SnapshotState`, produce snapshot state, and apply restored snapshot state atomically.
  - Added client tests `packages/client/src/store/snapshot.test.ts` covering round-trip restore (including cached outputs), strict version mismatch rejection, and invalid snapshot no-mutation behavior.
  - Updated documentation and planning artifacts for snapshot-only Phase 11: `docs/ENGINEERING.md`, `docs/SPECS.md`, `docs/PRD.md`, `docs/SCENARIOS.md`, `docs/ARCHITECTURE.md`, `docs/DATA_MODEL.md`, and `TASKS.md`.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Phase 11 snapshot size optimization completed:
  - Snapshot format upgraded to schemaVersion `3` with strict exact-version loading.
  - Implemented packed cached-output row encoding in `packages/client/src/store/snapshot.ts`:
    - New `rowsPacked` structure uses fixed `columns` metadata and numeric `data` tuples (CSV-like arrays).
    - Applied to all cached outputs in snapshots: `manual`, `monteCarlo`, `reforecast`, and stress base/scenario result rows (including workspace snapshots).
    - Decode-on-load restores canonical in-memory row objects, so chart/stats/table consumers remain unchanged.
  - Snapshot JSON now serializes in compact form to further reduce payload size.
  - Expanded snapshot tests in `packages/client/src/store/snapshot.test.ts` for malformed packed column headers and malformed row widths.
  - Updated `docs/SPECS.md`, `docs/ENGINEERING.md`, `docs/ARCHITECTURE.md`, `docs/DATA_MODEL.md`, `docs/SCENARIOS.md`, and `TASKS.md` to reflect packed snapshot output storage.
- Phase 12 documentation reconciliation pass completed (post-polish deltas):
  - Updated `docs/SPECS.md` to reflect shipped chart/detail/stress behavior: chart defaults to Real, label-style Breakdown controls, zoom/pan deferred, Detail Ledger naming/controls, CSV export deferred, and Stress panel default expanded.
  - Updated `docs/SCENARIOS.md` to align narratives with current UX (Detail Ledger naming, Breakdown control labels, no active zoom/pan flow, loading-state scenario, and no CSV-export scenario).
  - Updated `docs/ARCHITECTURE.md` to remove active CSV-export/zoom assumptions from current UI architecture, align component naming, and annotate deferred/reserved areas.
  - Updated `docs/PRD.md`, `docs/DATA_MODEL.md`, and `docs/API.md` with current-release scope and defaults (CSV deferred, `chartDisplayMode` default real, `stress.isExpanded` default true, `chartZoom` reserved).
- Phase 13 pre-implementation documentation update completed for Adaptive Dynamic SWR variant:
  - Updated `docs/WITHDRAWAL_STRATEGIES.md` with new **Strategy 5B: Adaptive Dynamic SWR (Monthly Realized TWR)**, including formulas for trailing real TWR (per-asset), weight aggregation, fallback ROI warm-up, and monthly-cadence recalculation details.
  - Updated `docs/SPECS.md` withdrawal strategy UX/spec to include **Dynamic SWR (Adaptive TWR)** in selector/tooltip/parameter panel, plus monthly-cadence exception to annual strategy behavior.
  - Updated `docs/DATA_MODEL.md` and `docs/API.md` to add `withdrawalStrategy.type = "dynamicSwrAdaptive"` with params `{ fallbackExpectedRateOfReturn, lookbackMonths }`.
  - Updated `docs/ARCHITECTURE.md` simulation/strategy architecture notes to document annual vs monthly strategy cadence and context requirements for realized-return-driven calculation.
  - Updated `docs/PRD.md` and `docs/SCENARIOS.md` strategy counts from 12 to 13.
- Implemented Adaptive Dynamic SWR feature (new withdrawal strategy variant):
  - Added `WithdrawalStrategyType.DynamicSwrAdaptive` and shared model/schema support with params `{ fallbackExpectedRateOfReturn, lookbackMonths }`.
  - Added server strategy implementation in `packages/server/src/engine/strategies/dynamicSwrAdaptive.ts` using trailing realized real TWR (per-asset), start-of-month weighted aggregation, nominal ROI conversion, fallback ROI warm-up, and monthly withdrawal output.
  - Updated simulation engines (`simulator.ts`, `deterministic.ts`) to support strategy-level monthly cadence for Adaptive Dynamic SWR while preserving annual cadence for all other strategies.
  - Wired client selector/params/tooltip support for "Dynamic SWR (Adaptive TWR)" in Withdrawal Strategy UI and store config mapping.
  - Added/updated tests: new adaptive strategy unit tests and simulator coverage for monthly recalculation behavior; expanded strategy sweep from 12 to 13 strategies.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- `npm run build`
- Fixed Adaptive Dynamic SWR spending-phase clamp behavior:
  - Updated `packages/server/src/engine/simulator.ts` to apply month-level inflation-adjusted min/max monthly spending bounds for monthly-cadence strategies (`dynamicSwrAdaptive`) instead of year-stepped annual/12 bounds.
  - Updated `packages/server/src/engine/deterministic.ts` with the same month-level clamp behavior for deterministic reforecast.
  - Added regression coverage in `packages/server/tests/engine/simulator.test.ts` to verify adaptive strategy monthly max clamp rises month-over-month under positive inflation.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`
- Adaptive SWR performance optimization implemented (no API/UX changes):
  - Added rolling trailing-return helper `packages/server/src/engine/helpers/rollingWindow.ts` to compute annualized realized returns in O(1) per month instead of re-slicing/reducing trailing arrays.
  - Added monthly inflation factor precompute helper `buildMonthlyInflationFactors` in `packages/server/src/engine/helpers/inflation.ts`.
  - Updated `packages/server/src/engine/simulator.ts` and `packages/server/src/engine/deterministic.ts`:
    - Adaptive strategy now consumes precomputed annualized realized returns from rolling tracker.
    - Adaptive monthly min/max clamping now uses O(1) lookup from precomputed monthly inflation factors.
    - Non-adaptive strategies remain unchanged in behavior.
  - Extended strategy context with optional `annualizedRealReturnsByAsset` to support optimized path while preserving fallback compatibility.
  - Added tests:
    - `packages/server/tests/engine/helpers/rollingWindow.test.ts`
    - `packages/server/tests/engine/helpers/inflation.test.ts`
    - Extended `packages/server/tests/engine/strategies/dynamicSwrAdaptive.test.ts` for precomputed annualized-return path.

Verification run (all passing):
- `npm run typecheck`
- `npm run lint`
- `npm test`

2026-02-17 (Phase 14 Compare Portfolios — core implementation)
- Implemented Compare mode foundations across shared and client store:
  - Added `AppMode.Compare`.
  - Added compare workspace state (`leftWorkspace`, `rightWorkspace`, `activeSlot`) with mode-switch seeding rules.
  - First switch into Compare now seeds Slot A from currently open workspace and initializes Slot B as clone of Slot A.
  - Added `setCompareActiveSlot`, per-slot compare run status/result actions, and compare selectors.
- Implemented Compare run orchestration in command bar:
  - Run Simulation in Compare mode issues dual `/simulate` calls.
  - Shared seed parity is applied across A/B runs to keep stochastic randomness aligned.
  - Per-slot errors/status are tracked.
- Implemented Compare UI core:
  - Command bar mode selector now includes Compare.
  - Sidebar now includes `Portfolio A / Portfolio B` slot switcher.
  - Summary stats now render A/B comparisons with delta values in Compare mode.
  - Portfolio chart now renders dual A/B paths in Compare mode.
  - Detail table now renders side-by-side ledgers in Compare mode with shared granularity/breakdown controls.
- Implemented snapshot compatibility for Compare:
  - Snapshot schema now supports optional compare workspace payload for backward compatibility.
  - Compare-mode load flow supports target prompts (`left`/`right`/`both`) and pair-slot selection (`A`/`B`) for single-side imports.
- Validation gates (all passing):
  - `npm run typecheck`
  - `npm run lint`
  - `npm test`
  - `npm run build`
- Remaining for Phase 14 completion:
  - Stress Test panel is not yet fully dual-slot compare-aware (currently core compare outputs are implemented for chart/stats/detail ledger).
- Phase 14 bug-fix pass: compare chart and output UX corrections.
  - Fixed Compare chart rendering to include robust axes/grid/ticks and hover tooltip for both slots.
  - Resolved missing Portfolio A line by correcting chart stroke token to `--theme-chart-manual-line` and drawing A over B.
  - Updated Compare stats cards so Portfolio A and B use same-size typography and chart-matching colors; delta is shown as annotation.
  - Added synchronized vertical + horizontal scroll locking between Compare Detail Ledger panes.
- Validation (client):
  - `npm run typecheck -w @finapp/client`
  - `npm run lint -w @finapp/client`
  - `npm run build -w @finapp/client`
- Phase 14 bug-fix pass: Compare + Monte Carlo parity and rendering.
  - Fixed compare slot result mode persistence by storing slot `simulationMode` when compare results are saved.
  - Fixed compare output selectors (stats/table/chart) to resolve per-slot result by currently selected simulation mode with safe fallback.
  - Implemented Compare-mode Monte Carlo chart overlays for both portfolios: P10-P90 and P25-P75 bands plus P50 median line per slot.
  - Updated compare MC legend labels to indicate percentile band rendering.
  - Verified compare stochastic fairness: both slots continue using shared seed per run invocation.
- Validation (client):
  - `npm run typecheck -w @finapp/client`
  - `npm run lint -w @finapp/client`
  - `npm run build -w @finapp/client`
- Phase 14/MC refinement: representative-path tie-break update.
  - Updated `runMonteCarlo` representative-path selection to use deterministic tie-break ordering:
    1) min terminal-distance to median terminal,
    2) min drawdown-distance to median total withdrawn,
    3) min total shortfall,
    4) stable first-match index.
  - Added MC engine test coverage asserting terminal-distance minimization and deterministic tie-break stability under fixed seed.
- Validation:
  - `npm test -w @finapp/server -- monteCarlo.test.ts`
  - `npm run typecheck`
  - `npm run lint`
